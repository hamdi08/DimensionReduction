IMPORT PBblas;
IMPORT $.^ as dr;
IMPORT $ as Tests;
IMPORT Tests.DiffReport as diffRep;

A := DATASET([
              {1, 1, 1, 7.0}, {1, 1, 2, 4.0}, {1, 1, 3, 3.0},
              {1, 2, 1, 4.0}, {1, 2, 2, 1.0}, {1, 2, 3, 8.0},
              {1, 3, 1, 6.0}, {1, 3, 2, 3.0}, {1, 3, 3, 5.0},
              {1, 4, 1, 8.0}, {1, 4, 2, 6.0}, {1, 4, 3, 1.0},
              {1, 5, 1, 8.0}, {1, 5, 2, 5.0}, {1, 5, 3, 7.0},
              {1, 6, 1, 7.0}, {1, 6, 2, 2.0}, {1, 6, 3, 9.0},
              {1, 7, 1, 5.0}, {1, 7, 2, 3.0}, {1, 7, 3, 3.0},
              {1, 8, 1, 9.0}, {1, 8, 2, 5.0}, {1, 8, 3, 8.0},
              {1, 9, 1, 7.0}, {1, 9, 2, 4.0}, {1, 9, 3, 5.0},
              {1, 10, 1, 8.0}, {1, 10, 2, 2.0}, {1, 10, 3, 2.0}],
              PBblas.Types.Layout_Cell);
d := 2;
//running linear kernel based PCA
Z1 := dr.kPCA(A, d);
//OUTPUT(Z1, NAMED('Z1'));
//validated in MATLAB
Z1_org := DATASET([
              {1, 1, 1, -7.8533}, {1, 1, 2, -48.0638},
              {1, 2, 1, -59.2463}, {1, 2, 2, -32.4508},
              {1, 3, 1, -27.7408}, {1, 3, 2, -43.3830},
              {1, 4, 1, 14.1954}, {1, 4, 2, -56.5460},
              {1, 5, 1, -37.5830}, {1, 5, 2, -62.1690},
              {1, 6, 1, -61.7931}, {1, 6, 2, -49.8854},
              {1, 7, 1, -12.3889}, {1, 7, 2, -36.2207},
              {1, 8, 1, -44.6653}, {1, 8, 2, -67.7606},
              {1, 9, 1, -24.3924}, {1, 9, 2, -51.2053},
              {1, 10, 1, -2.7193}, {1, 10, 2, -42.9111}],
              PBblas.Types.Layout_Cell);
test1 := diffRep.Compare_Cells('TEST1 -- kPCA -- linear ', Z1_org, Z1);
//OUTPUT(test1);


tp2 := 'gaussian';
Sigma := 2;
Z2 := dr.kPCA(A, d, tp2, Sigma);
//OUTPUT(Z2, NAMED('Z2'));
Z2_org := DATASET([
              {1, 1, 1, 0.856949}, {1, 1, 2, -0.287465},
              {1, 2, 1, -0.228555}, {1, 2, 2, 0.554604},
              {1, 3, 1, 0.591302}, {1, 3, 2, -0.585786},
              {1, 4, 1, 0.263370}, {1, 4, 2, 0.315616},
              {1, 5, 1, -0.709787}, {1, 5, 2, -0.764281},
              {1, 6, 1, -0.484254}, {1, 6, 2, 0.310987},
              {1, 7, 1, 0.779555}, {1, 7, 2, -0.279648},
              {1, 8, 1, -0.852012}, {1, 8, 2, -0.582210},
              {1, 9, 1, 0.411321}, {1, 9, 2, -0.771689},
              {1, 10, 1, 0.580053}, {1, 10, 2, 0.068351}],
              PBblas.Types.Layout_Cell);
test2 := diffRep.Compare_Cells('TEST2 -- kPCA -- Gaussian ', Z2_org, Z2);
//OUTPUT(test2);

tp3 := 'poly';
deg := 2;
Z3 := dr.kPCA(A, d, tp3, deg);
//OUTPUT(Z2, NAMED('Z2'));
Z3_org := DATASET([
              {1, 1, 1, -5921.48685}, {1, 1, 2, 5327.30687},
              {1, 2, 1, -10247.50523}, {1, 2, 2, -902.03034},
              {1, 3, 1, -8063.76411}, {1, 3, 2, 3115.23977},
              {1, 4, 1, -3969.25873}, {1, 4, 2, 8525.08630},
              {1, 5, 1, -15700.15894}, {1, 5, 2, 6538.23756},
              {1, 6, 1, -17197.67652}, {1, 6, 2, 1341.64398},
              {1, 7, 1, -4147.79598}, {1, 7, 2, 2732.97926},
              {1, 8, 1, -19761.54130}, {1, 8, 2, 7399.86742},
              {1, 9, 1, -9528.68868}, {1, 9, 2, 4959.89430},
              {1, 10, 1, -4432.58674}, {1, 10, 2, 4657.76525}],
              PBblas.Types.Layout_Cell);
test3 := diffRep.Compare_Cells('TEST3 -- kPCA -- Polynomial ', Z3_org, Z3);
//OUTPUT(test3);

rslt := SORT(test1 + test2 + test3, TestName);

EXPORT kPCATest := rslt;
